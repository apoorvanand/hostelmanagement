<% provide(:title, 'All Users') %>
<h1 id="top">All Users</h1>
<p><a href="#admins">Admins</a> / <a href="#reps">Housing Committee</a> / <a href="#students">Students</a></p>
<h3 id="admins">Admins</h3>
<% if @users.has_key? 'admin' %>
  <%= render 'table', users: @users['admin'], hide_actions: false %>
<% else %>
  <p>No admins!</p>
<% end %>

<h3 id="reps">Housing Committee (<%= @users['rep'].size %> total)</h3>
<p><a href="#top">Back to top</a></p>
<% if @users.has_key? 'rep' %>
  <%= render 'table', users: @users['rep'], hide_actions: false %>
<% else %>
  <p>No housing committee members!</p>
<% end %>

<h3 id="students">Students (<%= @users['student'].empty? ? 0 : @users['student'].values.map(&:size).reduce(:+) %> total)</h3>
<p><a href="#top">Back to top</a></p>
<% if @users.has_key? 'student' %>
  <ul class="tabs" data-tabs id="student-year-tabs">
    <% @users['student'].keys.sort.each do |year| %>
      <li class="tabs-title<%= @users['student'].keys.sort.first == year ? ' is-active' : '' %>">
        <a href="#students-<%= year %>"<%= @users['student'].keys.sort.first == year ? ' aria-selected=true' : '' %>><%= year %></a>
      </li>
    <% end %>
  </ul>
  <div class="tabs-content" data-tabs-content="student-year-tabs">
    <% @users['student'].keys.sort.each do |year| %>
      <div class="tabs-panel<%= @users['student'].keys.sort.first == year ? ' is-active' : '' %>" id="students-<%= year %>">
        <h4>Class of <%= year %> (<%= @users['student'][year].size %> total)</h4>
        <%= render 'table', users: @users['student'][year], hide_actions: false %>

        <% if policy(:user).bulk_destroy? %>
          <%= link_to "Remove Old Users", bulk_destroy_users_path(year), method: :delete, data: { confirm: "This action cannot be undone. Are you sure you want to delete ALL old users from #{year}. Old users are defined as users who have already received a room assignment." }, class: 'button alert', id: "remove-students-#{year}" %>
        <% end %>

      </div>
    <% end %>
  </div>
<% else %>
  <p>No regular students!</p>
<% end %>
